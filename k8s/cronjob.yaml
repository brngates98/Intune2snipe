apiVersion: v1
kind: Secret
metadata:
  name: intune2snipe-secrets
  # Note: Replace the placeholder values below with your actual credentials
  # Optional: AZURE_GROUP_IDS can be omitted if you don't need group filtering
type: Opaque
stringData:
  AZURE_TENANT_ID: "your-tenant-id"
  AZURE_CLIENT_ID: "your-client-id"
  AZURE_CLIENT_SECRET: "your-client-secret"
  SNIPEIT_URL: "https://your-snipeit-url/api/v1"
  SNIPEIT_API_TOKEN: "your-snipeit-api-token"
  SNIPEIT_DEFAULT_STATUS: "Ready to Deploy"
  AZURE_GROUP_IDS: "group-id-1,group-id-2"
---
apiVersion: batch/v1
kind: CronJob
metadata:
  name: intune2snipe-sync
  namespace: default
spec:
  # Run daily at 2:00 AM UTC
  schedule: "0 2 * * *"
  # Keep last 3 successful jobs and 1 failed job
  successfulJobsHistoryLimit: 3
  failedJobsHistoryLimit: 1
  concurrencyPolicy: Forbid
  jobTemplate:
    spec:
      template:
        metadata:
          labels:
            app: intune2snipe-sync
        spec:
          restartPolicy: OnFailure
          containers:
          - name: intune2snipe
            # Update with your container registry and image
            image: ghcr.io/your-org/your-repo:latest
            imagePullPolicy: Always
            envFrom:
            - secretRef:
                name: intune2snipe-secrets
            # Optional: Override default platform filter
            # args: ["--platform", "windows"]
            # Optional: Override group IDs via command-line argument
            # args: ["--groups", "group-id-1,group-id-2"]
            # Optional: Run in dry-run mode
            # args: ["--dry-run"]
            resources:
              requests:
                memory: "128Mi"
                cpu: "100m"
              limits:
                memory: "512Mi"
                cpu: "500m"

